{"filter":false,"title":"API.js","tooltip":"/API.js","undoManager":{"mark":37,"position":37,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":179,"column":2},"action":"insert","lines":["var server = require(\"./server\")","","module.exports = {","  ","","// ---------------------------- swarm-redistribution API ----------------------------------","","// coin-agnostic general purpuse API - connect any coin platform","// my swarm-redistribution API is the major component of project resilience","// and what I called peer-to-peer-dividend-protocols","// http://resilience.me and http://basicincome.co","","// the API can be used by any coin, money, thing, platform","","// first, get_collection() loads a nodes dividend pathways","// see video Systems-Architechture [2014], https://www.youtube.com/watch?v=PmPq3ywnnoI","","get_collection: function() {","    //connect your coin here, this is how you connect to the API","    //the callback feeds collection/dividend-pathways","    //this example connects with http://client.basicincome.co","server.get_dividend_lines(swarm_redistribution)","}","","","","// -------------------------- STUFF:","// ALL THIS needs to be improved...","","    var lines = [];//lines.push(line)","   ","    ","    var x = 0;//recursion()","    var y = 0;//recursion()","   ","    var temp = \" \";","    ","    var taxRate_quota_temp = []","    var taxRate_quota_sum = 0","    var taxRate_switch = false","    var taxRate_x;","    var taxRate_ratio_x;","","","","","","// ---------------------- SWARM-REDISTRIBUTION ----------------------------","","function swarm_redistribution(pathway){","","console.log(pathway)","","// ------- First, construct fractal dividend lines -----------------","// see http://www.resilience.me/theory.html","",""," var w = 0;"," var line = []",""," if(pathway.length>0){","","    loop(pathway, line, w);// add taxRate ratios","    "," }"," else{"," console.log(\"collection is empty\")"," next_node()"," }","","    ","    ","    ","    function loop(pathway, line, w) {","    var q = 0","    // calculate taxRatio","    console.log(w)","    console.log(pathway[w])","    var taxRate_y = pathway[w].taxRate","    if(taxRate_switch === false){","     taxRate_x = taxRate","     taxRate_ratio_x = 1","    }","    else taxRate_x = taxRate","    if(taxRate_y > taxRate_x)taxRate_y = taxRate_x","    var taxRate_ratio_y = Number(taxRate_y) / Number(taxRate_x)","    var taxRate_quota = Number(taxRate_ratio_x) * Number(taxRate_ratio_y)","    console.log(temp.indexOf(pathway[w].account))","    ","    // push lines","    if (temp.indexOf(pathway[w].account) === -1){","    temp+= pathway[w].account + \" \"","    line.push({account: pathway[w].account, currency: currency, taxRate: taxRate, taxRate_quota: taxRate_quota});","    taxRate_quota_temp.push(taxRate_quota)","    taxRate_quota_sum = Number(taxRate_quota_sum) + Number(taxRate_quota)","    q++","    }","    else console.log(\"CIRCULAR\");","    ","    w++;","    ","    if (w<pathway.length){loop(pathway, w, line)}","    else {","        if (q>0){","            console.log(line);//lists all dividend pathways in IOUs[0] for ACCOUNT_ID","            lines.push(line)","        };","        ","        next_node()","    }","    }","","      ","// STEP 2: branch out (add all dividend pathways for lines[x][i].account)        ","","","    function next_node(){","            if(x<lines.length){","            console.log(\"recursion nr \"+x)","        if(y<lines[x].length){","            console.log(\"taxRate_quota:\" +lines[x][y].taxRate_quota)","            taxRate_ratio_x = Number(lines[x][y].taxRate_quota)","            taxRate_x = lines[x][y].taxRate","            COLLECTION = lines[x][y].account;","            y++;","            get_collection();","        }","                ","        else {","           x++;","           y = 0;","            console.log(\"recursion nr \"+x)","            get_collection()","        }","        ","            }","            else console.log(lines), console.log(\"END\"), outgoing_payments()","        }","         ","             ","    // ------- SECOND, outgoing payments -----------------","    // see http://www.resilience.me/theory.html ","    function outgoing_payments(){","         var total_amount_pie = Number(total_amount)/taxRate_quota_sum","         ","         // create outgoing payment","         x = 0","         y = 0","         loop()","         function loop(){","            if (x<lines.length){     ","                if (y<lines[x].length){","                ","                var amount = Number(total_amount_pie * lines[x][y].taxRate_quota)","                var currency = lines[x][y].currency","                var account = lines[x][y].account","                var payment = {account: account, amount: amount, currency: currency}","                send_client(payment)","                y++","                loop()","                }","                else x++","                loop()","            }else q++, get_collection();","         }","}","   ","","function send_client(payment){","    console.log(\"outgoing payments sent !\")","            conn.sendText(JSON.stringify(payment));","            ","}","","        ","}//end swarm_redistribution()","","","","};"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"remove","lines":["var server = require(\"./server\")",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":0,"column":14},"action":"remove","lines":["module.exports"]},{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":8},"end":{"row":0,"column":9},"action":"insert","lines":["A"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"insert","lines":["P"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":10},"end":{"row":0,"column":11},"action":"insert","lines":["I"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":14},"end":{"row":0,"column":15},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":15},"end":{"row":0,"column":16},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":16},"end":{"row":0,"column":17},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":17},"end":{"row":0,"column":18},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":18},"end":{"row":0,"column":19},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":19},"end":{"row":0,"column":20},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":20},"end":{"row":0,"column":21},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":21},"end":{"row":0,"column":22},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":22},"end":{"row":0,"column":23},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":22},"end":{"row":0,"column":23},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":22},"end":{"row":0,"column":23},"action":"insert","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":23},"end":{"row":0,"column":24},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":0},"end":{"row":15,"column":1},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":1},"end":{"row":15,"column":2},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":2},"end":{"row":15,"column":3},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":3},"end":{"row":15,"column":4},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":18},"end":{"row":15,"column":19},"action":"remove","lines":[":"]},{"start":{"row":15,"column":18},"end":{"row":15,"column":19},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":19},"end":{"row":15,"column":20},"action":"insert","lines":["?"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":20},"end":{"row":15,"column":21},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":20},"end":{"row":15,"column":21},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":19},"end":{"row":15,"column":20},"action":"remove","lines":["?"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":19},"end":{"row":15,"column":20},"action":"insert","lines":["="]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":30,"column":27},"end":{"row":30,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1417000386000,"hash":"a957df70ba9c436c5c575e65b2cbe853698dea84"}