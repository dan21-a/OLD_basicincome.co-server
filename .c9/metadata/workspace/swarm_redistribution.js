{"filter":false,"title":"swarm_redistribution.js","tooltip":"/swarm_redistribution.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":145,"column":133},"end":{"row":145,"column":134},"action":"insert","lines":["E"]}]}],[{"group":"doc","deltas":[{"start":{"row":145,"column":134},"end":{"row":145,"column":135},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":145,"column":135},"end":{"row":145,"column":136},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":145,"column":136},"end":{"row":145,"column":137},"action":"insert","lines":["I"]}]}],[{"group":"doc","deltas":[{"start":{"row":145,"column":137},"end":{"row":145,"column":138},"action":"insert","lines":["O"]}]}],[{"group":"doc","deltas":[{"start":{"row":145,"column":138},"end":{"row":145,"column":139},"action":"insert","lines":["N"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":16},"end":{"row":208,"column":17},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":17},"end":{"row":208,"column":18},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":18},"end":{"row":208,"column":19},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":19},"end":{"row":208,"column":20},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":20},"end":{"row":208,"column":21},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":21},"end":{"row":208,"column":22},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":22},"end":{"row":208,"column":23},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":23},"end":{"row":208,"column":24},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":208,"column":0},"end":{"row":209,"column":0},"action":"remove","lines":["                console.",""]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":0},"end":{"row":224,"column":29},"action":"remove","lines":["var ACCOUNT_ID = db.collection(account_id);","","var COLLECTION = db.collection(account_id);","    ","    ","var q = 0//loop through all currencies","","function get_dividend_lines(callback){","    get_wallet()","    function get_wallet(){","    ACCOUNT_ID.find({type:\"tax_blob\"}, function(err,doc){","        ","        if(q<doc.length){","        var total_amount = doc[q].total_amount","        var currency = doc[q].currency","","        // get the taxRate","        ACCOUNT_ID.findOne({type: \"wallet\", currency: doc[q].currency}, function(err,doc){","","        var taxRate=doc.taxRate;","","        get_dividend_pathway(taxRate, currency, total_amount)","        })","        }","        else console.log(\"swarm-redistribution finished for all currencies\")","    });","    }","    ","    function get_dividend_pathway(taxRate, currency, total_amount){","  ","    console.log(\"scanning collection: \"+ COLLECTION);","    COLLECTION.find({type: \"dividend_pathway\", currency: currency},function(err, doc) {","","    callback(doc, taxRate, total_amount)","","    });","","}","","}","","        ","","var get_collection = function() {","    //connect your coin here, this is how you connect to the API","    //the callback feeds collection/dividend-pathways","    //this example connects with http://client.basicincome.co","get_dividend_lines(swarm_redistribution)","}","get_collection()","","","// -------------------------- STUFF:","// ALL THIS needs to be improved...","","    var lines = [];//lines.push(line)","   ","    ","    var x = 0;//recursion()","    var y = 0;//recursion()","    var z = 0","   ","    var taxRate_quota_sum = 0","    var taxRate_switch = false","    var taxRate_x;","    var taxRate_ratio_x;","","","","","","// ---------------------- SWARM-REDISTRIBUTION ----------------------------","","function swarm_redistribution(pathway, taxRate, total_amount){","","","// ------- First, construct fractal dividend lines -----------------","// see http://www.resilience.me/theory.html","",""," var w = 0;"," var line = []"," "," taxRate_x = taxRate"," taxRate_ratio_x = 1","","",""," if(pathway.length>0){","","    loop(pathway, line, w, taxRate, total_amount);// add taxRate ratios","    "," }"," else{"," console.log(\"collection is empty\")"," next_node(total_amount)"," }","","    ","    ","    function loop(pathway, line, w, taxRate, total_amount) {","    // calculate taxRatio","    function calculate_taxRatio(pathway, line, w, taxRate, total_amount){","    var taxRate_y = pathway[w].taxRate","   ","    if(taxRate_y > taxRate_x)taxRate_y = taxRate_x","    var taxRate_ratio_y = Number(taxRate_y) / Number(taxRate_x)","    var taxRate_quota = Number(taxRate_ratio_x) * Number(taxRate_ratio_y)","    push_lines(taxRate_quota, total_amount)","    }","    calculate_taxRatio(pathway, line, w, taxRate, total_amount)","","    function push_lines(taxRate_quota, total_amount){","","    // push lines","    if (JSON.stringify(lines).indexOf(pathway[w].account) === -1 && pathway[w].account !== account_id){","    line.push({account: pathway[w].account, currency: pathway[w].currency, taxRate: taxRate, taxRate_quota: taxRate_quota, node: COLLECTION});","    taxRate_quota_sum = Number(taxRate_quota_sum) + Number(taxRate_quota)","    }","    else console.log(\"CIRCULAR\");","    ","    w++;","    console.log(w)","    ","    if (w<pathway.length){loop(pathway, line, w, taxRate, total_amount)}","    else {","        if (line.length>0){","            lines.push(line)","        };","        console.log(lines)","        next_node(total_amount)","    }","    }","    }","","      ","// STEP 2: branch out (add all dividend pathways for lines[x][i].account)        ","","","    function next_node(total_amount){","            if(x<lines.length){","            ","                ","        if(y<lines[x].length){","            taxRate_ratio_x = Number(lines[x][y].taxRate_quota)","            taxRate_x = lines[x][y].taxRate","            COLLECTION = db.collection(lines[x][y].account);","            ","            y++;","            z++","            console.log(\"recursion nr \"+z)","            get_collection();","        }","                ","        else {","            x++;","            y = 0","            next_node(total_amount)","          ","        }","        ","            }","            else console.log(lines), console.log(\"generating payments...\"), outgoing_payments(total_amount)","        }","         ","             ","    // ------- SECOND, outgoing payments -----------------","    // see http://www.resilience.me/theory.html ","    function outgoing_payments(total_amount){","         var total_amount_pie = Number(total_amount)/taxRate_quota_sum","         ","         // create outgoing payment","         x = 0","         y = 0","         loop()","         function loop(){","","            if (x<lines.length){     ","                if (y<lines[x].length){","                var amount = Number(total_amount_pie * lines[x][y].taxRate_quota)","                var currency = lines[x][y].currency","                var account = lines[x][y].account","                var payment = {account: account, amount: amount, currency: currency}","                ","                callback(payment, account_id)","                y++","                loop()","                }","                else x++, y =0, loop()","            }else q++, console.log(\"swarm-redistribution for currency: \"+lines[0][0].currency +\" is done. loading next currency...\"),COLLECTION = db.collection(account_id), get_collection();","         }//create outgoing payments to everyone in the swarm","    }","   ","","        ","}//end swarm_redistribution()"]},{"start":{"row":29,"column":0},"end":{"row":227,"column":29},"action":"insert","lines":["var ACCOUNT_ID = db.collection(account_id);","var ACCOUNT = account_id","","var COLLECTION = db.collection(ACCOUNT);","    ","    ","var q = 0//loop through all currencies","","function get_dividend_lines(callback){","    get_wallet()","    function get_wallet(){","    ACCOUNT_ID.find({type:\"tax_blob\"}, function(err,doc){","        ","        if(q<doc.length){","        var total_amount = doc[q].total_amount","        var currency = doc[q].currency","","        // get the taxRate","        ACCOUNT_ID.findOne({type: \"wallet\", currency: doc[q].currency}, function(err,doc){","","        var taxRate=doc.taxRate;","","        get_dividend_pathway(taxRate, currency, total_amount)","        })","        }","        else console.log(\"swarm-redistribution finished for all currencies\")","    });","    }","    ","    function get_dividend_pathway(taxRate, currency, total_amount){","  ","    console.log(\"scanning collection: \"+ COLLECTION);","    COLLECTION.find({type: \"dividend_pathway\", currency: currency},function(err, doc) {","","    callback(doc, taxRate, total_amount)","","    });","","}","","}","","        ","","var get_collection = function() {","    //connect your coin here, this is how you connect to the API","    //the callback feeds collection/dividend-pathways","    //this example connects with http://client.basicincome.co","COLLECTION = db.collection(ACCOUNT);","get_dividend_lines(swarm_redistribution)","}","get_collection()","","","// -------------------------- STUFF:","// ALL THIS needs to be improved...","","    var lines = [];//lines.push(line)","   ","    ","    var x = 0;//recursion()","    var y = 0;//recursion()","    var z = 0","   ","    var taxRate_quota_sum = 0","    var taxRate_switch = false","    var taxRate_x;","    var taxRate_ratio_x;","","","","","","// ---------------------- SWARM-REDISTRIBUTION ----------------------------","","function swarm_redistribution(pathway, taxRate, total_amount){","","","// ------- First, construct fractal dividend lines -----------------","// see http://www.resilience.me/theory.html","",""," var w = 0;"," var line = []"," "," taxRate_x = taxRate"," taxRate_ratio_x = 1","","",""," if(pathway.length>0){","","    loop(pathway, line, w, taxRate, total_amount);// add taxRate ratios","    "," }"," else{"," console.log(\"collection is empty\")"," next_node(total_amount)"," }","","    ","    ","    function loop(pathway, line, w, taxRate, total_amount) {","    // calculate taxRatio","    function calculate_taxRatio(pathway, line, w, taxRate, total_amount){","    var taxRate_y = pathway[w].taxRate","   ","    if(taxRate_y > taxRate_x)taxRate_y = taxRate_x","    var taxRate_ratio_y = Number(taxRate_y) / Number(taxRate_x)","    var taxRate_quota = Number(taxRate_ratio_x) * Number(taxRate_ratio_y)","    push_lines(taxRate_quota, total_amount)","    }","    calculate_taxRatio(pathway, line, w, taxRate, total_amount)","","    function push_lines(taxRate_quota, total_amount){","","    // push lines","    if (JSON.stringify(lines).indexOf(pathway[w].account) === -1 && pathway[w].account !== account_id){","    line.push({account: pathway[w].account, currency: pathway[w].currency, taxRate: taxRate, taxRate_quota: taxRate_quota, node: ACCOUNT});","    taxRate_quota_sum = Number(taxRate_quota_sum) + Number(taxRate_quota)","    }","    else console.log(\"CIRCULAR\");","    ","    w++;","    console.log(w)","    ","    if (w<pathway.length){loop(pathway, line, w, taxRate, total_amount)}","    else {","        if (line.length>0){","            lines.push(line)","        };","        console.log(lines)","        next_node(total_amount)","    }","    }","    }","","      ","// STEP 2: branch out (add all dividend pathways for lines[x][i].account)        ","","","    function next_node(total_amount){","            if(x<lines.length){","            ","                ","        if(y<lines[x].length){","            taxRate_ratio_x = Number(lines[x][y].taxRate_quota)","            taxRate_x = lines[x][y].taxRate","            ACCOUNT = lines[x][y].account;","            ","            y++;","            z++","            console.log(\"recursion nr \"+z)","            get_collection();","        }","                ","        else {","            x++;","            y = 0","            next_node(total_amount)","          ","        }","        ","            }","            else console.log(lines), console.log(\"generating payments...\"), outgoing_payments(total_amount)","        }","         ","             ","    // ------- SECOND, outgoing payments -----------------","    // see http://www.resilience.me/theory.html ","    function outgoing_payments(total_amount){","         var total_amount_pie = Number(total_amount)/taxRate_quota_sum","         ","         // create outgoing payment","         x = 0","         y = 0","         loop()","         function loop(){","","            if (x<lines.length){     ","                if (y<lines[x].length){","                console.log(lines[x][y])","                var amount = Number(total_amount_pie * lines[x][y].taxRate_quota)","                var currency = lines[x][y].currency","                var account = lines[x][y].account","                var payment = {account: account, amount: amount, currency: currency, node: lines[x][y].node}","                ","                console.log(payment)","                y++","                loop()","                }","                else x++, y =0, loop()","            }else q++, console.log(\"swarm-redistribution for currency: \"+lines[0][0].currency +\" is done. loading next currency...\"),ACCOUNT = account_id, get_collection();","         }//create outgoing payments to everyone in the swarm","    }","   ","","        ","}//end swarm_redistribution()"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":16},"end":{"row":216,"column":23},"action":"remove","lines":["console"]},{"start":{"row":216,"column":16},"end":{"row":216,"column":17},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":17},"end":{"row":216,"column":18},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":18},"end":{"row":216,"column":19},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":19},"end":{"row":216,"column":20},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":20},"end":{"row":216,"column":21},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":21},"end":{"row":216,"column":22},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":22},"end":{"row":216,"column":23},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":23},"end":{"row":216,"column":24},"action":"insert","lines":["k"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":24},"end":{"row":216,"column":28},"action":"remove","lines":[".log"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":32},"end":{"row":216,"column":33},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":33},"end":{"row":216,"column":34},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":34},"end":{"row":216,"column":35},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":35},"end":{"row":216,"column":36},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":35},"end":{"row":216,"column":36},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":35},"end":{"row":216,"column":36},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":36},"end":{"row":216,"column":37},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":37},"end":{"row":216,"column":38},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":38},"end":{"row":216,"column":39},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":39},"end":{"row":216,"column":40},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":40},"end":{"row":216,"column":41},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":41},"end":{"row":216,"column":42},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":42},"end":{"row":216,"column":43},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":43},"end":{"row":216,"column":44},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":216,"column":45},"end":{"row":217,"column":0},"action":"insert","lines":["",""]},{"start":{"row":217,"column":0},"end":{"row":217,"column":16},"action":"insert","lines":["                "]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":16},"end":{"row":217,"column":17},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":17},"end":{"row":217,"column":18},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":18},"end":{"row":217,"column":19},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":19},"end":{"row":217,"column":20},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":20},"end":{"row":217,"column":21},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":21},"end":{"row":217,"column":22},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":22},"end":{"row":217,"column":23},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":23},"end":{"row":217,"column":24},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":24},"end":{"row":217,"column":25},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":25},"end":{"row":217,"column":26},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":26},"end":{"row":217,"column":27},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":27},"end":{"row":217,"column":29},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":28},"end":{"row":217,"column":30},"action":"insert","lines":["\"\""]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":29},"end":{"row":217,"column":30},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":30},"end":{"row":217,"column":31},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":31},"end":{"row":217,"column":32},"action":"insert","lines":["j"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":29},"end":{"row":217,"column":32},"action":"remove","lines":["hej"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":29},"end":{"row":217,"column":30},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":28},"end":{"row":217,"column":29},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":28},"end":{"row":217,"column":29},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":217,"column":0},"end":{"row":218,"column":0},"action":"remove","lines":["                console.log(x)",""]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":65},"end":{"row":61,"column":66},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":66},"end":{"row":61,"column":67},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":67},"end":{"row":61,"column":68},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":68},"end":{"row":61,"column":69},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":69},"end":{"row":61,"column":70},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":70},"end":{"row":61,"column":71},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":71},"end":{"row":61,"column":72},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":72},"end":{"row":61,"column":73},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":73},"end":{"row":61,"column":74},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":73},"end":{"row":61,"column":74},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":72},"end":{"row":61,"column":73},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":71},"end":{"row":61,"column":72},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":70},"end":{"row":61,"column":71},"action":"remove","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":69},"end":{"row":61,"column":70},"action":"remove","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":68},"end":{"row":61,"column":69},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":67},"end":{"row":61,"column":68},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":66},"end":{"row":61,"column":67},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":65},"end":{"row":61,"column":66},"action":"remove","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":65},"end":{"row":61,"column":66},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":66},"end":{"row":61,"column":67},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":67},"end":{"row":61,"column":68},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":68},"end":{"row":61,"column":69},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":69},"end":{"row":61,"column":70},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":70},"end":{"row":61,"column":71},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":71},"end":{"row":61,"column":72},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":72},"end":{"row":61,"column":73},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":73},"end":{"row":61,"column":74},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":74},"end":{"row":61,"column":75},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":75},"end":{"row":61,"column":76},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":76},"end":{"row":61,"column":87},"action":"insert","lines":["{ $lte: 5 }"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":84},"end":{"row":61,"column":85},"action":"remove","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":84},"end":{"row":61,"column":85},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":85},"end":{"row":61,"column":86},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":86},"end":{"row":61,"column":87},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":87},"end":{"row":61,"column":88},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":88},"end":{"row":61,"column":89},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":89},"end":{"row":61,"column":90},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":61,"column":90},"end":{"row":61,"column":91},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":58,"column":3},"end":{"row":62,"column":0},"action":"remove","lines":[" function get_dividend_pathway(taxRate, currency, total_amount){","  ","    console.log(\"scanning collection: \"+ COLLECTION);","    COLLECTION.find({type: \"dividend_pathway\", currency: currency, taxRate: { $lte: taxRate }},function(err, doc) {",""]},{"start":{"row":58,"column":3},"end":{"row":62,"column":0},"action":"insert","lines":[" function get_dividend_pathway(taxRate, currency, total_amount){","  ","    console.log(\"scanning collection: \"+ COLLECTION);","    COLLECTION.find({type: \"dividend_pathway\", currency: currency, taxRate: { $lte: taxRate }},function(err, doc) {",""]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":0},"end":{"row":41,"column":0},"action":"remove","lines":["    ACCOUNT_ID.find({type:\"tax_blob\"}, function(err,doc){",""]},{"start":{"row":40,"column":0},"end":{"row":41,"column":0},"action":"insert","lines":["    ACCOUNT_ID.find({type:\"tax_blob\", total_amount: {$gt: 0}}, function(err,doc){",""]}]}]]},"ace":{"folds":[{"start":{"row":37,"column":38},"end":{"row":69,"column":0},"placeholder":"..."}],"scrolltop":2496.222264289856,"scrollleft":0,"selection":{"start":{"row":209,"column":39},"end":{"row":209,"column":39},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":66,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1417169119642,"hash":"c99d73c714602a320c4e5df2c6ef87fe560827f1"}