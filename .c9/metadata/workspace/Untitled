{"filter":false,"title":"Untitled","tooltip":"/Untitled","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":84,"column":6},"action":"insert","lines":["   ","        function do_something(){}","        ","        console.log(\"Received: \"+str);","        BLOB = JSON.parse(str)","        ACCOUNT_ID = BLOB[0].account_id","        WALLET = BLOB[1]","        COLLECTION = ACCOUNT_ID","","","","","","","// ---------------------------- swarm-redistribution ----------------------------------","","// FIRST, collect data from the coin platform",""," // this example connects with http://client.basicincome.co","","    var taxRate","    var total_amount","","    ","    var currency","    var q = 0","","module.exports = {","","get_dividend_lines: function(callback){","    get_wallet()","    function get_wallet(){","    tax_blob = mongoose.model('tax_blob', tax_blob_schema, ACCOUNT_ID);","    // get the currency","    tax_blob.find({type: \"tax_blob\"}).exec(function(err,doc){","        if(q<doc.length){","        total_amount = doc[q].total_amount","        currency = doc[q].currency;","","        ","        wallet = mongoose.model('wallet', wallet_schema, ACCOUNT_ID);","        // get the taxRate","        wallet.findOne({type: \"wallet\", currency: currency}).exec(function(err,doc){","        taxRate=doc.taxRate;","        get_dividend_pathway()","        })","        }","    });","    }","    ","    function get_dividend_pathway(){","  ","    dividend_pathway = mongoose.model('dividend_pathway', dividend_pathways_schema, COLLECTION);//to insert new COLLECTION","    console.log(\"scanning collection: \"+ COLLECTION);","    dividend_pathway.find({type: \"dividend_pathway\", currency: currency} ).exec(function(err, doc) {","    callback(doc)","    ","","    });","","}","","}","","}","","// ---------------------------- update currency/taxRate ----------------------------------","","        ","","        // update wallet","        wallet.remove({ type: 'wallet' },function(err, wallet){})","        loop()","        function loop(){","                    new wallet({ type: \"wallet\", currency: WALLET[i].currency, taxRate: WALLET[i].taxRate }).save(function(err){});","                    i++","                    if(i<WALLET.length){loop()}","                    else{(i=0)","                    if(accounts.indexOf(ACCOUNT_ID)===-1){get_collections}//add collection to request_subscribe()","}","        }","        ","        ","        ","    })"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":84,"column":6},"end":{"row":84,"column":6},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1416936811349,"hash":"858aaad2720a66f10c158c73f59a5d2528bea3b3"}